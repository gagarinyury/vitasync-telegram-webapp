# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## VitaSync Telegram WebApp

VitaSync - —ç—Ç–æ Telegram WebApp –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–∏—Ç–∞–º–∏–Ω–æ–≤ –∏ –ë–ê–î–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI.

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (05/17/2025)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–≤–µ—Ç–∞–º–∏ –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–º –≤ UI
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ localStorage –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–±–∞–≤–æ–∫
4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ checkLimits ‚Üí getLimits –≤ analysisService

### üîß –í –ø—Ä–æ—Ü–µ—Å—Å–µ:
1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ
2. –û—Ç–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –≤ —Ç–æ–º –∂–µ –æ–∫–Ω–µ
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã backend API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–±–æ–µ API
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–±–∞–≤–æ–∫

## Essential Commands

### Development - ‚úÖ WORKING

#### Frontend (WebApp) - ‚úÖ FULLY FUNCTIONAL
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
cd /root/vitasync-telegram-webapp
npm install  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ workspaces

# –ó–∞–ø—É—Å–∫ frontend
cd frontend
npm run dev
```

#### Backend API - ‚úÖ WORKING
```bash
# –°–ø–æ—Å–æ–± 1: –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
source .env && cd backend && npm run dev

# –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ workspace (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
cd /root/vitasync-telegram-webapp
npm run dev:backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl http://localhost:3000/api/health
```

#### Telegram Bot - ‚ö†Ô∏è TO BE CONFIGURED
```bash
# –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
./run-bot-only.sh  # –ë—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–∑–∂–µ
```

### Testing & Linting
```bash
# Frontend
cd frontend && npm run lint

# Backend
cd backend && npm run lint
cd backend && npm test
```

### Production - ‚úÖ CONFIGURED
```bash
# SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
# - /root/ssl-certs/SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã/
# - /etc/caddy/SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã/

# Caddy —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç:
# https://profy.top/webapp/ ‚Üí localhost:5173
# https://profy.top/api/ ‚Üí localhost:3000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
sudo systemctl status caddy
curl -k https://profy.top/webapp/
```

## High-Level Architecture

### System Components
1. **Telegram Bot** (telegraf)
   - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram
   - –ö–æ–º–∞–Ω–¥–∞ /start —Å–æ–∑–¥–∞–µ—Ç WebApp URL
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL

2. **Frontend** (React + Vite)
   - Material UI –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - Zustand –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - Telegram WebApp SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –ó–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5173

3. **Backend API** (Express.js)
   - JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram init data
   - REST API –¥–ª—è webapp
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - –ó–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000

4. **Infrastructure**
   - Caddy: Reverse proxy —Å SSL (profy.top)
   - PostgreSQL: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í–∞–ª–∏–¥–Ω—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è Telegram

### Data Flow
1. User ‚Üí Telegram Bot ‚Üí –ü–æ–ª—É—á–∞–µ—Ç WebApp URL
2. User ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
3. Frontend ‚Üí API –∑–∞–ø—Ä–æ—Å—ã ‚Üí Backend
4. Backend ‚Üí OpenAI API ‚Üí –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí PostgreSQL ‚Üí Frontend

### Key Directories
```
/root/vitasync-telegram-webapp/
‚îú‚îÄ‚îÄ frontend/           # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ backend/            # Express API
‚îú‚îÄ‚îÄ bot-only.js        # –û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç
‚îú‚îÄ‚îÄ Caddyfile          # Caddy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .env               # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

### Environment Variables
–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env:
- TELEGRAM_BOT_TOKEN
- TELEGRAM_WEBAPP_URL=https://profy.top/webapp/
- OPENAI_API_KEY
- DATABASE_URL
- JWT_SECRET

### UI Components
- HomePage: –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–æ–∫
- AnalysisPage: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- MainMenuPage: –ö—Ä–∞—Å–∏–≤–æ–µ –º–µ–Ω—é —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- ProfilePage: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- SchedulePage: –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞ (–∑–∞–≥–ª—É—à–∫–∞)

### Important Patterns
1. Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç dotenv –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. Frontend –ù–ï –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å —Ñ–ª–∞–≥–æ–º --host ‚ùó
3. Telegram —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π SSL –¥–ª—è WebApp
4. Caddy –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç:
   - /webapp/* ‚Üí localhost:5173
   - /api/* ‚Üí localhost:3000
5. Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 3000, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞

### Common Issues & Solutions ‚úÖ
1. Backend –Ω–µ –≤–∏–¥–∏—Ç env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Üí —Ç–µ–ø–µ—Ä—å dotenv –ø–æ–¥–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. Telegram bot –æ—à–∏–±–∫–∞ "invalid URL" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TELEGRAM_WEBAPP_URL
3. SSL –æ—à–∏–±–∫–∏ ‚Üí —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –µ—Å—Ç—å –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö:
   - `/root/ssl-certs/SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã/`
   - `/etc/caddy/SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã/`
4. Port already in use ‚Üí `sudo lsof -i :PORT` –∑–∞—Ç–µ–º `kill -9 PID`
5. Vite –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí –∑–∞–ø—É—Å–∫–∞—Ç—å `npm install` –∏–∑ –∫–æ—Ä–Ω—è (workspaces)
6. Vite –±–ª–æ–∫–∏—Ä—É–µ—Ç profy.top ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ `allowedHosts` –≤ vite.config.js
7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL
8. OpenAI API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å OPENAI_API_KEY –≤ .env —Ñ–∞–π–ª–µ
9. **–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ username** ‚Üí ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ auth.js:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sanitizeUserData()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ undefined –∑–Ω–∞—á–µ–Ω–∏–π
   - –í—Å–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ null
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Development Tips
1. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ./start-webapp-only.sh (–ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
2. –ó–∞–ø—É—Å–∫–∞–π—Ç–µ frontend –∏ backend –æ—Ç–¥–µ–ª—å–Ω–æ
3. Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
4. Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç nodemon –¥–ª—è –∞–≤—Ç–æ-—Ä–µ—Å—Ç–∞—Ä—Ç–∞
5. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å vite –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã

### Vite Configuration ‚úÖ
```javascript
// frontend/vite.config.js
{
  server: {
    host: 'localhost',
    port: 5173,
    strictPort: true,
    cors: true,
    allowedHosts: ['profy.top', 'localhost'],  // –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ Caddy
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  },
  base: '/webapp/',
}
```

### Security Notes
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- Telegram init data –≤–∞–ª–∏–¥–∞—Ü–∏—è
- SSL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è production
- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å .env —Ñ–∞–π–ª