const { Telegraf } = require('telegraf');

const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN);

// Start command
bot.command('start', async (ctx) => {
  const user = ctx.from;
  const webAppUrl = `${process.env.TELEGRAM_WEBAPP_URL}?tg_user_id=${user.id}`;
  
  await ctx.reply('Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² VitaSync! ðŸ’Š\n\nÐ¯ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ð²Ð°Ð¼ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð² Ð¸ Ð‘ÐÐ”Ð¾Ð², Ð° Ñ‚Ð°ÐºÐ¶Ðµ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸ÐµÐ¼Ð°.\n\nðŸ¤– P.S. Ð¯ Ð²ÑÐµÐ³Ð¾ Ð»Ð¸ÑˆÑŒ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð½Ðµ ÑÑƒÐ´Ð¸Ñ‚Ðµ Ð¼ÐµÐ½Ñ ÑÑ‚Ñ€Ð¾Ð³Ð¾! Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¼Ð¾Ð³Ñƒ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ñ‚Ð¾Ñ€Ð¼Ð¾Ð·Ð¸Ñ‚ÑŒ, Ð½Ð¾ ÑÑ‚Ð°Ñ€Ð°ÑŽÑÑŒ Ð¸Ð·Ð¾ Ð²ÑÐµÑ… ÑÐ¸Ð» ðŸ˜Š', {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: 'ðŸš€ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ',
            web_app: { url: webAppUrl }
          }
        ],
        [
          {
            text: 'ðŸ“š Ðž Ð±Ð¾Ñ‚Ðµ',
            callback_data: 'about'
          },
          {
            text: 'ðŸ’¬ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°',
            callback_data: 'support'
          }
        ]
      ]
    }
  });
});

// About callback
bot.action('about', async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(`
ðŸ” *Ðž VitaSync*

VitaSync - ÑÑ‚Ð¾ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð² Ð¸ Ð‘ÐÐ”Ð¾Ð².

*Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸:*
â€¢ ÐÐ½Ð°Ð»Ð¸Ð· ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð¾Ðº Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ AI
â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð¿Ñ€Ð¸ÐµÐ¼Ð°
â€¢ ÐÐ°ÑƒÑ‡Ð½Ð¾ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
â€¢ Ð”Ð²Ð° Ñ€ÐµÐ¶Ð¸Ð¼Ð° AI: ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð¸ Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼

*ÐšÐ°Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ:*
1. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
2. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð²Ð°ÑˆÐ¸ Ð´Ð¾Ð±Ð°Ð²ÐºÐ¸
3. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ð°Ð½Ð°Ð»Ð¸Ð· ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸
4. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸ÐµÐ¼Ð°

âš ï¸ *Ð’Ð°Ð¶Ð½Ð¾:* ÐÐ°ÑˆÐ¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð½Ðµ Ð·Ð°Ð¼ÐµÐ½ÑÑŽÑ‚ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸ÑŽ Ð²Ñ€Ð°Ñ‡Ð°!

ðŸ¤– *P.S.* Ð¯ Ð¿Ð¾ÐºÐ° Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿ MVP, Ñ‚Ð°Ðº Ñ‡Ñ‚Ð¾ ÐµÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾Ð¹Ð´ÐµÑ‚ Ð½Ðµ Ñ‚Ð°Ðº - Ð½Ðµ Ð¾Ð±ÐµÑÑÑƒÐ´ÑŒÑ‚Ðµ! Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð±ÐµÑ‚Ð°-Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ðŸ˜…
`, 
    { parse_mode: 'Markdown' }
  );
});

// Support callback
bot.action('support', async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply('ÐŸÐ¾ Ð²ÑÐµÐ¼ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ: @your_support_username');
});

// Handle errors
bot.catch((err, ctx) => {
  console.error('Error:', err);
});

// Launch bot
bot.launch();

console.log('Bot started at', new Date().toISOString());

// Graceful shutdown
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
